<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.site.client.member.sell.dao.ClSellDAO">

<insert id="paymentInsert" parameterType="sell" useGeneratedKeys="true" keyProperty="order_num">
		/*member - memberInsert*/
		 <selectKey keyProperty="order_num" resultType="java.lang.String" order="BEFORE">
			<!-- SELECT last_day((SELECT to_char(trunc(add_months(sysdate, 11), 'dd'),'YYYY/MM/DD') FROM dual)) FROM dual -->
			SELECT to_char(sysdate,'yyyy/mm/dd')||'_'||sell_seq.nextval from dual
		</selectKey>
		Insert into SELL (ORDER_NUM,SELL_EA,SELL_DATE,
		SELL_MONEY,BANK_NAME,BANK,COUPON_NO,M_NUM,MT,ENDDATE) 
		values (#{order_num},to_number(#{sell_ea}),sysdate,
		to_number(#{sell_money}),#{bank_name},#{bank},
		#{coupon_no},#{m_num},#{mt},to_char(trunc(add_months(sysdate, 12), 'dd'),'yyyy/mm/dd'))
		
	</insert>

	<select id="getOrder_Money" parameterType="orderList" resultType="int">
	/*단품 단가 주입조회*/
		select pd_cost from product where pd_num = #{pd_num}
	</select>

	<insert id="orderListInsert" parameterType="orderList">
		insert into order_list(order_num, pd_num, order_date, order_ea, order_money, order_ok, transit_num)
		values (#{order_num}, #{pd_num}, sysdate, to_number(#{order_ea}), to_number(#{order_money}), '주문대기_'||to_char(sysdate,'yymmdd_hh24miss),
		'30232-851-'||transit_seq.nextval)
	</insert>
	<delete id="paymentBack" parameterType="sell">
	/*결재완료 부결시 결제 취소*/
		delete from sell where order_num = #{order_num}
	</delete>
</mapper>